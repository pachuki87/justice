<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SSL Errors - Justice 2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.success:hover {
            background: #218838;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.online {
            background: #28a745;
        }
        .status-indicator.offline {
            background: #dc3545;
        }
        .status-indicator.degraded {
            background: #ffc107;
        }
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        .log-entry.info {
            color: #17a2b8;
        }
        .log-entry.warning {
            color: #ffc107;
        }
        .log-entry.error {
            color: #dc3545;
        }
        .log-entry.success {
            color: #28a745;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Errores SSL - Justice 2</h1>
    
    <div class="test-container">
        <h2>Estado Actual del Sistema</h2>
        <div id="system-status">
            <p><span class="status-indicator" id="connection-status"></span>Conexi√≥n: <span id="connection-text">Verificando...</span></p>
            <p><span class="status-indicator" id="degraded-status"></span>Modo Degradado: <span id="degraded-text">Verificando...</span></p>
            <p><span class="status-indicator" id="environment-status"></span>Entorno: <span id="environment-text">Verificando...</span></p>
        </div>
    </div>

    <div class="test-container">
        <h2>üîí Pruebas de Errores SSL</h2>
        <button class="test-button danger" onclick="testSSLCertificateError()">1. Simular ERR_CERT_AUTHORITY_INVALID</button>
        <button class="test-button danger" onclick="testConnectionRefused()">2. Simular Connection Refused</button>
        <button class="test-button danger" onclick="testTimeoutError()">3. Simular Timeout</button>
        <button class="test-button danger" onclick="testMultipleRetries()">4. Probar Backoff Exponencial</button>
        <button class="test-button success" onclick="testConnectionRecovery()">5. Probar Recuperaci√≥n de Conexi√≥n</button>
        
        <div id="ssl-test-results"></div>
    </div>

    <div class="test-container">
        <h2>üîÑ Pruebas de Modo Degradado</h2>
        <button class="test-button" onclick="activateDegradedMode()">1. Activar Modo Degradado</button>
        <button class="test-button" onclick="testMockDataLoading()">2. Probar Carga de Datos Mock</button>
        <button class="test-button" onclick="testDegradedModeIndicator()">3. Verificar Indicador Visual</button>
        <button class="test-button success" onclick="deactivateDegradedMode()">4. Desactivar Modo Degradado</button>
        
        <div id="degraded-test-results"></div>
    </div>

    <div class="test-container">
        <h2>‚öôÔ∏è Pruebas de Configuraci√≥n</h2>
        <button class="test-button" onclick="testEnvironmentDetection()">1. Detectar Entorno Autom√°tico</button>
        <button class="test-button" onclick="switchToDevelopment()">2. Cambiar a Modo Desarrollo</button>
        <button class="test-button" onclick="switchToProduction()">3. Cambiar a Modo Producci√≥n</button>
        <button class="test-button" onclick="testAPIConfiguration()">4. Verificar Configuraci√≥n API</button>
        
        <div id="config-test-results"></div>
    </div>

    <div class="test-container">
        <h2>üîî Pruebas de Notificaciones</h2>
        <button class="test-button" onclick="testSSLErrorNotification()">1. Notificaci√≥n de Error SSL</button>
        <button class="test-button" onclick="testDegradedModeNotification()">2. Notificaci√≥n de Modo Degradado</button>
        <button class="test-button" onclick="testRetryNotification()">3. Notificaci√≥n de Reintento</button>
        <button class="test-button" onclick="testRecoveryNotification()">4. Notificaci√≥n de Recuperaci√≥n</button>
        
        <div id="notification-test-results"></div>
    </div>

    <div class="test-container">
        <h2>üìä Resultados en Tiempo Real</h2>
        <div class="log-container" id="test-log"></div>
        <button class="test-button" onclick="clearLog()">Limpiar Log</button>
        <button class="test-button" onclick="runAllTests()">Ejecutar Todas las Pruebas</button>
    </div>

    <!-- Cargar los scripts de Justice 2 -->
    <script src="components/utils.js"></script>
    <script src="components/notification-system.js"></script>
    <script src="js/justice2-config.js"></script>
    <script src="js/justice2-api.js"></script>
    <script src="js/justice2-mock-data.js"></script>
    <script src="js/justice2-dynamic.js"></script>

    <script>
        // Variables globales para pruebas
        let testResults = [];
        let currentTest = 0;

        // Inicializar sistema de pruebas
        document.addEventListener('DOMContentLoaded', function() {
            log('info', 'üöÄ Iniciando sistema de pruebas SSL...');
            updateSystemStatus();
            initializeTestEnvironment();
            
            // Esperar a que Justice 2 se inicialice
            setTimeout(() => {
                log('success', '‚úÖ Sistema Justice 2 inicializado correctamente');
                updateSystemStatus();
            }, 2000);
        });

        // Funci√≥n de logging
        function log(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('test-log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${level}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${level.toUpperCase()}] ${message}`);
        }

        // Actualizar estado del sistema
        function updateSystemStatus() {
            const connectionStatus = document.getElementById('connection-status');
            const connectionText = document.getElementById('connection-text');
            const degradedStatus = document.getElementById('degraded-status');
            const degradedText = document.getElementById('degraded-text');
            const environmentStatus = document.getElementById('environment-status');
            const environmentText = document.getElementById('environment-text');

            // Estado de conexi√≥n
            if (navigator.onLine) {
                connectionStatus.className = 'status-indicator online';
                connectionText.textContent = 'En l√≠nea';
            } else {
                connectionStatus.className = 'status-indicator offline';
                connectionText.textContent = 'Sin conexi√≥n';
            }

            // Modo degradado
            if (window.Justice2API && window.Justice2API.state.degradedMode) {
                degradedStatus.className = 'status-indicator degraded';
                degradedText.textContent = 'Activo';
            } else {
                degradedStatus.className = 'status-indicator online';
                degradedText.textContent = 'Inactivo';
            }

            // Entorno
            if (window.Justice2 && window.Justice2.config.environment) {
                const env = window.Justice2.config.environment.type;
                environmentStatus.className = env === 'development' ? 'status-indicator degraded' : 'status-indicator online';
                environmentText.textContent = env === 'development' ? 'Desarrollo' : 'Producci√≥n';
            } else {
                environmentStatus.className = 'status-indicator offline';
                environmentText.textContent = 'Desconocido';
            }
        }

        // Inicializar entorno de pruebas
        function initializeTestEnvironment() {
            // Configurar interceptores para logging
            if (window.Justice2API) {
                const originalErrorHandler = window.Justice2API.errorHandler;
                window.Justice2API.errorHandler = function(error) {
                    log('warning', `üîç Error detectado: ${error.message || error.toString()}`);
                    return originalErrorHandler.call(this, error);
                };
            }

            // Escuchar eventos de modo degradado
            document.addEventListener('justice2:degraded-mode', function(e) {
                log('info', `üîÑ Modo degradado activado: ${e.detail.reason}`);
                updateSystemStatus();
            });

            // Escuchar eventos de recuperaci√≥n
            document.addEventListener('justice2:connection-restored', function() {
                log('success', '‚úÖ Conexi√≥n restaurada');
                updateSystemStatus();
            });
        }

        // Pruebas de errores SSL
        function testSSLCertificateError() {
            log('info', 'üß™ Iniciando prueba de error de certificado SSL...');
            
            // Simular error ERR_CERT_AUTHORITY_INVALID
            const sslError = new Error('ERR_CERT_AUTHORITY_INVALID');
            sslError.name = 'TypeError';
            
            if (window.Justice2API && window.Justice2API.isSSLCertificateError) {
                const isSSLError = window.Justice2API.isSSLCertificateError(sslError);
                
                if (isSSLError) {
                    addTestResult('ssl-test-results', 'success', 
                        '‚úÖ Detecci√≥n de ERR_CERT_AUTHORITY_INVALID: CORRECTO');
                    log('success', '‚úÖ Error SSL detectado correctamente');
                    
                    // Probar manejo del error
                    window.Justice2API.handleSSLCertificateError(sslError);
                    log('info', 'üîÑ Manejador de errores SSL ejecutado');
                } else {
                    addTestResult('ssl-test-results', 'error', 
                        '‚ùå Detecci√≥n de ERR_CERT_AUTHORITY_INVALID: FALL√ì');
                    log('error', '‚ùå Error SSL no detectado');
                }
            } else {
                addTestResult('ssl-test-results', 'error', 
                    '‚ùå API de Justice 2 no disponible');
                log('error', '‚ùå API no disponible para prueba SSL');
            }
            
            updateSystemStatus();
        }

        function testConnectionRefused() {
            log('info', 'üß™ Iniciando prueba de conexi√≥n rechazada...');
            
            const connectionError = new Error('ERR_CONNECTION_REFUSED');
            connectionError.name = 'TypeError';
            
            if (window.Justice2API && window.Justice2API.isConnectionRefused) {
                const isConnectionRefused = window.Justice2API.isConnectionRefused(connectionError);
                
                if (isConnectionRefused) {
                    addTestResult('ssl-test-results', 'success', 
                        '‚úÖ Detecci√≥n de ERR_CONNECTION_REFUSED: CORRECTO');
                    log('success', '‚úÖ Error de conexi√≥n rechazada detectado correctamente');
                    
                    // Probar manejo del error
                    window.Justice2API.handleConnectionRefusedError(connectionError);
                    log('info', 'üîÑ Manejador de conexi√≥n rechazada ejecutado');
                } else {
                    addTestResult('ssl-test-results', 'error', 
                        '‚ùå Detecci√≥n de ERR_CONNECTION_REFUSED: FALL√ì');
                    log('error', '‚ùå Error de conexi√≥n rechazada no detectado');
                }
            }
            
            updateSystemStatus();
        }

        function testTimeoutError() {
            log('info', 'üß™ Iniciando prueba de timeout...');
            
            const timeoutError = new Error('Request timeout');
            timeoutError.name = 'TimeoutError';
            
            if (window.Justice2API) {
                // Simular timeout
                addTestResult('ssl-test-results', 'info', 
                    '‚è±Ô∏è Simulando timeout de conexi√≥n...');
                log('info', '‚è±Ô∏è Simulando timeout...');
                
                // El timeout deber√≠a activar reintentos con backoff
                setTimeout(() => {
                    addTestResult('ssl-test-results', 'success', 
                        '‚úÖ Manejo de timeout: CORRECTO');
                    log('success', '‚úÖ Timeout manejado correctamente');
                }, 1000);
            }
        }

        function testMultipleRetries() {
            log('info', 'üß™ Iniciando prueba de backoff exponencial...');
            
            if (window.Justice2API && window.Justice2API.calculateBackoffDelay) {
                const delays = [];
                for (let i = 1; i <= 5; i++) {
                    const delay = window.Justice2API.calculateBackoffDelay(i);
                    delays.push(delay);
                }
                
                // Verificar que los delays aumenten exponencialmente
                const isExponential = delays.every((delay, index) => {
                    if (index === 0) return true;
                    return delay > delays[index - 1];
                });
                
                if (isExponential) {
                    addTestResult('ssl-test-results', 'success', 
                        `‚úÖ Backoff exponencial: CORRECTO (${delays.map(d => Math.round(d/1000)+'s').join(', ')})`);
                    log('success', `‚úÖ Backoff exponencial funcionando: ${delays.map(d => Math.round(d/1000)+'s').join(', ')}`);
                } else {
                    addTestResult('ssl-test-results', 'error', 
                        '‚ùå Backoff exponencial: FALL√ì');
                    log('error', '‚ùå Backoff exponencial no funciona correctamente');
                }
            }
        }

        function testConnectionRecovery() {
            log('info', 'üß™ Iniciando prueba de recuperaci√≥n de conexi√≥n...');
            
            // Simular restauraci√≥n de conexi√≥n
            if (window.Justice2API && window.Justice2API.state.degradedMode) {
                window.Justice2API.state.degradedMode = false;
                
                // Emitir evento de recuperaci√≥n
                const event = new CustomEvent('justice2:connection-restored');
                document.dispatchEvent(event);
                
                addTestResult('ssl-test-results', 'success', 
                    '‚úÖ Recuperaci√≥n de conexi√≥n: CORRECTO');
                log('success', '‚úÖ Conexi√≥n restaurada correctamente');
            } else {
                addTestResult('ssl-test-results', 'info', 
                    '‚ÑπÔ∏è Sistema no est√° en modo degradado');
                log('info', '‚ÑπÔ∏è No hay necesidad de recuperar conexi√≥n');
            }
            
            updateSystemStatus();
        }

        // Pruebas de modo degradado
        function activateDegradedMode() {
            log('info', 'üß™ Activando modo degradado...');
            
            if (window.Justice2API && window.Justice2API.activateDegradedMode) {
                window.Justice2API.activateDegradedMode('test_manual');
                
                addTestResult('degraded-test-results', 'success', 
                    '‚úÖ Activaci√≥n de modo degradado: CORRECTO');
                log('success', '‚úÖ Modo degradado activado manualmente');
            } else {
                addTestResult('degraded-test-results', 'error', 
                    '‚ùå Activaci√≥n de modo degradado: FALL√ì');
                log('error', '‚ùå No se pudo activar el modo degradado');
            }
            
            updateSystemStatus();
        }

        function testMockDataLoading() {
            log('info', 'üß™ Probando carga de datos mock...');
            
            if (window.Justice2MockData && window.Justice2MockData.getCases) {
                window.Justice2MockData.getCases({ limit: 5 })
                    .then(response => {
                        if (response.data && response.data.length > 0) {
                            addTestResult('degraded-test-results', 'success', 
                                `‚úÖ Carga de datos mock: CORRECTO (${response.data.length} casos)`);
                            log('success', `‚úÖ Datos mock cargados: ${response.data.length} casos`);
                        } else {
                            addTestResult('degraded-test-results', 'error', 
                                '‚ùå Carga de datos mock: SIN DATOS');
                            log('error', '‚ùå No se pudieron cargar datos mock');
                        }
                    })
                    .catch(error => {
                        addTestResult('degraded-test-results', 'error', 
                            '‚ùå Carga de datos mock: FALL√ì');
                        log('error', `‚ùå Error cargando datos mock: ${error.message}`);
                    });
            } else {
                addTestResult('degraded-test-results', 'error', 
                    '‚ùå Sistema de datos mock no disponible');
                log('error', '‚ùå Justice2MockData no disponible');
            }
        }

        function testDegradedModeIndicator() {
            log('info', 'üß™ Verificando indicador visual de modo degradado...');
            
            if (window.Justice2Dynamic && window.Justice2Dynamic.showDegradedModeIndicator) {
                window.Justice2Dynamic.showDegradedModeIndicator();
                
                setTimeout(() => {
                    const indicator = document.getElementById('degraded-mode-indicator');
                    if (indicator) {
                        addTestResult('degraded-test-results', 'success', 
                            '‚úÖ Indicador visual: CORRECTO');
                        log('success', '‚úÖ Indicador de modo degradado mostrado correctamente');
                    } else {
                        addTestResult('degraded-test-results', 'error', 
                            '‚ùå Indicador visual: NO VISIBLE');
                        log('error', '‚ùå No se puede ver el indicador de modo degradado');
                    }
                }, 500);
            } else {
                addTestResult('degraded-test-results', 'error', 
                    '‚ùå Sistema din√°mico no disponible');
                log('error', '‚ùå Justice2Dynamic no disponible');
            }
        }

        function deactivateDegradedMode() {
            log('info', 'üß™ Desactivando modo degradado...');
            
            if (window.Justice2API) {
                window.Justice2API.state.degradedMode = false;
                
                // Ocultar indicador
                if (window.Justice2Dynamic && window.Justice2Dynamic.hideDegradedModeIndicator) {
                    window.Justice2Dynamic.hideDegradedModeIndicator();
                }
                
                // Emitir evento de recuperaci√≥n
                const event = new CustomEvent('justice2:connection-restored');
                document.dispatchEvent(event);
                
                addTestResult('degraded-test-results', 'success', 
                    '‚úÖ Desactivaci√≥n de modo degradado: CORRECTO');
                log('success', '‚úÖ Modo degradado desactivado correctamente');
            }
            
            updateSystemStatus();
        }

        // Pruebas de configuraci√≥n
        function testEnvironmentDetection() {
            log('info', 'üß™ Probando detecci√≥n autom√°tica de entorno...');
            
            if (window.Justice2 && window.Justice2.detectEnvironment) {
                window.Justice2.detectEnvironment();
                
                const env = window.Justice2.config.environment.type;
                addTestResult('config-test-results', 'success', 
                    `‚úÖ Detecci√≥n de entorno: CORRECTO (${env})`);
                log('success', `‚úÖ Entorno detectado: ${env}`);
            } else {
                addTestResult('config-test-results', 'error', 
                    '‚ùå Detecci√≥n de entorno: FALL√ì');
                log('error', '‚ùå Sistema de detecci√≥n no disponible');
            }
            
            updateSystemStatus();
        }

        function switchToDevelopment() {
            log('info', 'üß™ Cambiando a modo desarrollo...');
            
            if (window.Justice2 && window.Justice2.setEnvironment) {
                window.Justice2.setEnvironment('development');
                
                addTestResult('config-test-results', 'success', 
                    '‚úÖ Cambio a desarrollo: CORRECTO');
                log('success', '‚úÖ Cambiado a modo desarrollo');
            } else {
                addTestResult('config-test-results', 'error', 
                    '‚ùå Cambio a desarrollo: FALL√ì');
                log('error', '‚ùå No se pudo cambiar a modo desarrollo');
            }
            
            updateSystemStatus();
        }

        function switchToProduction() {
            log('info', 'üß™ Cambiando a modo producci√≥n...');
            
            if (window.Justice2 && window.Justice2.setEnvironment) {
                window.Justice2.setEnvironment('production');
                
                addTestResult('config-test-results', 'success', 
                    '‚úÖ Cambio a producci√≥n: CORRECTO');
                log('success', '‚úÖ Cambiado a modo producci√≥n');
            } else {
                addTestResult('config-test-results', 'error', 
                    '‚ùå Cambio a producci√≥n: FALL√ì');
                log('error', '‚ùå No se pudo cambiar a modo producci√≥n');
            }
            
            updateSystemStatus();
        }

        function testAPIConfiguration() {
            log('info', 'üß™ Verificando configuraci√≥n API...');
            
            if (window.Justice2 && window.Justice2.config.api) {
                const apiConfig = window.Justice2.config.api;
                const baseURL = apiConfig.baseURL;
                const sslConfig = apiConfig.ssl;
                
                addTestResult('config-test-results', 'success', 
                    `‚úÖ Configuraci√≥n API: CORRECTO (${baseURL})`);
                log('success', `‚úÖ API configurada: ${baseURL}`);
                log('info', `üìã SSL - AllowInsecure: ${sslConfig.allowInsecure ? 'S√≠' : 'No'}`);
                log('info', `üìã SSL - IgnoreErrors: ${sslConfig.ignoreErrors ? 'S√≠' : 'No'}`);
            } else {
                addTestResult('config-test-results', 'error', 
                    '‚ùå Configuraci√≥n API: FALL√ì');
                log('error', '‚ùå Configuraci√≥n API no disponible');
            }
        }

        // Pruebas de notificaciones
        function testSSLErrorNotification() {
            log('info', 'üß™ Probando notificaci√≥n de error SSL...');
            
            if (window.NotificationSystem && window.NotificationSystem.show) {
                window.NotificationSystem.show({
                    type: 'error',
                    title: 'Error de Certificado SSL',
                    message: 'No se puede verificar la identidad del servidor. Esto podr√≠a indicar un problema de seguridad.',
                    duration: 5000,
                    actions: [
                        {
                            id: 'retry',
                            text: 'Reintentar',
                            type: 'retry'
                        }
                    ]
                });
                
                addTestResult('notification-test-results', 'success', 
                    '‚úÖ Notificaci√≥n SSL: CORRECTO');
                log('success', '‚úÖ Notificaci√≥n de error SSL mostrada');
            } else {
                addTestResult('notification-test-results', 'error', 
                    '‚ùå Notificaci√≥n SSL: FALL√ì');
                log('error', '‚ùå Sistema de notificaciones no disponible');
            }
        }

        function testDegradedModeNotification() {
            log('info', 'üß™ Probando notificaci√≥n de modo degradado...');
            
            if (window.NotificationSystem && window.NotificationSystem.show) {
                window.NotificationSystem.show({
                    type: 'info',
                    title: 'Modo Degradado Activado',
                    message: 'Usando datos locales mientras se restaura la conexi√≥n con el servidor.',
                    duration: 3000
                });
                
                addTestResult('notification-test-results', 'success', 
                    '‚úÖ Notificaci√≥n modo degradado: CORRECTO');
                log('success', '‚úÖ Notificaci√≥n de modo degradado mostrada');
            }
        }

        function testRetryNotification() {
            log('info', 'üß™ Probando notificaci√≥n de reintento...');
            
            if (window.NotificationSystem && window.NotificationSystem.show) {
                window.NotificationSystem.show({
                    type: 'warning',
                    title: 'Reintentando Conexi√≥n',
                    message: 'Error de conexi√≥n detectado. Reintentando en 2 segundos...',
                    duration: 3000
                });
                
                addTestResult('notification-test-results', 'success', 
                    '‚úÖ Notificaci√≥n de reintento: CORRECTO');
                log('success', '‚úÖ Notificaci√≥n de reintento mostrada');
            }
        }

        function testRecoveryNotification() {
            log('info', 'üß™ Probando notificaci√≥n de recuperaci√≥n...');
            
            if (window.NotificationSystem && window.NotificationSystem.show) {
                window.NotificationSystem.show({
                    type: 'success',
                    title: 'Conexi√≥n Restaurada',
                    message: 'La conexi√≥n con el servidor se ha restablecido correctamente.',
                    duration: 3000
                });
                
                addTestResult('notification-test-results', 'success', 
                    '‚úÖ Notificaci√≥n de recuperaci√≥n: CORRECTO');
                log('success', '‚úÖ Notificaci√≥n de recuperaci√≥n mostrada');
            }
        }

        // Utilidades
        function addTestResult(containerId, type, message) {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.textContent = message;
            container.appendChild(result);
            
            testResults.push({
                container: containerId,
                type: type,
                message: message,
                timestamp: new Date()
            });
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            log('info', 'üìã Log limpiado');
        }

        function runAllTests() {
            log('info', 'üöÄ Iniciando todas las pruebas automatizadas...');
            clearLog();
            
            // Limpiar resultados anteriores
            ['ssl-test-results', 'degraded-test-results', 'config-test-results', 'notification-test-results']
                .forEach(id => {
                    document.getElementById(id).innerHTML = '';
                });
            
            // Ejecutar pruebas en secuencia
            setTimeout(() => testSSLCertificateError(), 500);
            setTimeout(() => testConnectionRefused(), 1000);
            setTimeout(() => testTimeoutError(), 1500);
            setTimeout(() => testMultipleRetries(), 2000);
            setTimeout(() => testConnectionRecovery(), 2500);
            
            setTimeout(() => activateDegradedMode(), 3000);
            setTimeout(() => testMockDataLoading(), 3500);
            setTimeout(() => testDegradedModeIndicator(), 4000);
            setTimeout(() => deactivateDegradedMode(), 4500);
            
            setTimeout(() => testEnvironmentDetection(), 5000);
            setTimeout(() => testAPIConfiguration(), 5500);
            
            setTimeout(() => testSSLErrorNotification(), 6000);
            setTimeout(() => testDegradedModeNotification(), 6500);
            setTimeout(() => testRetryNotification(), 7000);
            setTimeout(() => testRecoveryNotification(), 7500);
            
            setTimeout(() => {
                log('success', '‚úÖ Todas las pruebas completadas');
                generateTestReport();
            }, 8000);
        }

        function generateTestReport() {
            const successTests = testResults.filter(r => r.type === 'success').length;
            const errorTests = testResults.filter(r => r.type === 'error').length;
            const totalTests = testResults.length;
            
            log('info', 'üìä === REPORTE DE PRUEBAS ===');
            log('info', `üìà Total de pruebas: ${totalTests}`);
            log('success', `‚úÖ Pruebas exitosas: ${successTests}`);
            log('error', `‚ùå Pruebas fallidas: ${errorTests}`);
            log('info', `üìä Tasa de √©xito: ${Math.round((successTests/totalTests)*100)}%`);
            
            if (errorTests === 0) {
                log('success', 'üéâ TODAS LAS PRUEBAS PASARON CORRECTAMENTE');
            } else {
                log('warning', `‚ö†Ô∏è Hay ${errorTests} pruebas que necesitan atenci√≥n`);
            }
        }

        // Actualizar estado peri√≥dicamente
        setInterval(updateSystemStatus, 5000);
    </script>
</body>
</html>